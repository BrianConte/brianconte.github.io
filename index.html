<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <link href="https://fonts.googleapis.com/css?family=Anton" rel="stylesheet" type="text/css"></link>
  <link type="text/css" href="examplegantt.css" rel="stylesheet" />
  <style>
  .tooltip
  {
   display: inline;
   position: relative;
  }
  .tooltip:hover:after
  {
   background: #333;
   background: rgba(0,0,0,.8);
   border-radius: 5px;
   bottom: 26px;
   color: #fff;
   content: attr(title);
   left: 20%;
   padding: 5px 15px;
   position: absolute;
   z-index: 98;
   width: 220px;
   max-width: 220px;
  }
    .links line {
      stroke: #999;
      stroke-opacity: 0.6;
    }

    .nodes circle {
      stroke: #fff;
      stroke-width: 1.5px;
    }
  </style>
</head>

<body>
  <!--<object id="skillsObject" data="skills.svg" type="image/svg+xml" width="400" height="400" style="border:1px solid black">SVG not supported</object>-->
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 600 400" id="skills"></svg>
  <div  id="experience"></div>

  <script src="https://d3js.org/d3.v4.min.js"></script>
<!--  <script type="text/javascript" src="../lib/d3/d3.v3.js"></script>
	<script type="text/javascript" src="../lib/d3/moment.min.js"></script>
  <script type="text/javascript" src="example3.js"></script>
-->
<script type="text/javascript" src="gantt.js"></script>
<script type="text/javascript" src="examplegantt.js"></script>
</body>
  <script src="d3-tip.js"></script>
  <script>
    var svgSkills = d3.select("#skills"),
      width = +svgSkills.attr("width"),
      height = +svgSkills.attr("height");

    var color = d3.scaleOrdinal(d3.schemeCategory20);

    var simulation = d3.forceSimulation()
      .force("link", d3.forceLink().distance(100).strength(1).id(function(d) {
        return d.id;
      }))
      .force("charge", d3.forceManyBody())
      .force("collide", d3.forceCollide(function(d) {
        return d.r + 8
      }).iterations(32))
      .force("center", d3.forceCenter(width / 2, height / 2));

    d3.json("skills.json", function(error, graph) {
      if (error) throw error;

      var link = svgSkills.append("g")
        .attr("class", "links")
        .selectAll("line")
        .data(graph.links)
        .enter().append("line")
        .attr("stroke-width", function(d) {
          return Math.sqrt(d.value);
        });

      /* Initialize tooltip */
  //    var tip = d3
  //    .tip()
  //      .html(function(d) {
  //        return d;
//        });

      /* Invoke the tip in the context of your visualization */
//      svgSkills.call(tip)

      var node = svgSkills.append("g")
        .attr("class", "nodes")
        .selectAll("circle")
        .data(graph.nodes)
        .enter().append("circle")
//        .on('mouseover', tip.show)
//        .on('mouseout', tip.hide)
        .attr("r", function(d) {
          return d.r;
        })
        .attr("fill", function(d) {
          return color(d.group);
        })
        .call(d3.drag()
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended));

      var text = svgSkills.selectAll("text")
        .data(graph.nodes)
        .enter()
        .append("g");

      text
        .append("text")
        .text(function(d) {
          return d.id;
        })
        .attr("dy", 0)
        .attr("dx", 0)
        .attr("text-anchor", "middle")
        .style("font-family", "Anton")
        .style("font-size", function(d) {
          return d.r / 3 + "px"
        })
        .style("fill", "white")
        .style("text-transform", "uppercase");

      svgSkills.selectAll("text")
        .data(graph.nodes)
        .call(wrap, function(d) {
          return d.r * 2
        });


      node.append("title")
        .text(function(d) {
          return d.fullText;
        });

      simulation
        .nodes(graph.nodes)
        .on("tick", ticked);

      simulation.force("link")
        .links(graph.links);

      function ticked() {
        link
          .attr("x1", function(d) {
            return d.source.x;
          })
          .attr("y1", function(d) {
            return d.source.y;
          })
          .attr("x2", function(d) {
            return d.target.x;
          })
          .attr("y2", function(d) {
            return d.target.y;
          });

        node
          .attr("cx", function(d) {
            return d.x;
          })
          .attr("cy", function(d) {
            return d.y;
          });

        text
          .attr("transform", function(d) {
            return "translate(" + d.x + "," + d.y + ")";
          })
      }
    });

    function dragstarted(d) {
      if (!d3.event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
    }

    function dragged(d) {
      d.fx = d3.event.x;
      d.fy = d3.event.y;
    }

    function dragended(d) {
      if (!d3.event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    }

    function wrap(text, width) {
      text.each(function(d) {
        var text = d3.select(this),
          words = text.text().split(/\s+/).reverse(),
          word,
          line = [],
          lineNumber = 0,
          lineHeight = 1.1, // ems
          y = text.attr("y"),
  //        dy = parseFloat(text.attr("dy")),
          dy = 0.4
          tspan = text.text(null).append("tspan").attr("x", 0).attr("y", y).attr("dy", dy + "em");
        while (word = words.pop()) {
          line.push(word);
          tspan.text(line.join(" "));
          if (tspan.node().getComputedTextLength() > width(d)) {
            if (line.length > 1) {
              tspan.node().setAttribute("dy", (dy-0.55) + "em")
              line.pop();
              tspan.text(line.join(" "));
              line = [word];
              //        tspan = text.append("tspan").attr("x", 0).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
              tspan = text.append("tspan").attr("x", 0).attr("y", y).attr("dy", lineHeight + "em").text(word);
            }
          }
        }
      });
    }
  </script>

</body>

</html>
